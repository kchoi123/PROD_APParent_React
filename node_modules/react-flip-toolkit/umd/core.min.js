!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ReactFlipToolkitCore=e()}(this,function(){"use strict";function t(t){if(t.constructor!==Array)throw new TypeError("Expected array.");if(16===t.length)return t;if(6===t.length){var i=e();return i[0]=t[0],i[1]=t[1],i[4]=t[2],i[5]=t[3],i[12]=t[4],i[13]=t[5],i}throw new RangeError("Expected array with either 6 or 16 values.")}function e(){for(var t=[],e=0;e<16;e++)e%5==0?t.push(1):t.push(0);return t}function i(e,i){for(var n=t(e),r=t(i),a=[],o=0;o<4;o++)for(var s=[n[o],n[o+4],n[o+8],n[o+12]],l=0;l<4;l++){var p=4*l,u=[r[p],r[p+1],r[p+2],r[p+3]],c=s[0]*u[0]+s[1]*u[1]+s[2]*u[2]+s[3]*u[3];a[o+p]=c}return a}var n=function(t){return"number"==typeof t},r=function(t){return Array.prototype.slice.apply(t)};function a(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.forEach(function(e){if(e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}),t}var o,s={noWobble:{stiffness:200,damping:26},gentle:{stiffness:120,damping:14},veryGentle:{stiffness:130,damping:17},wobbly:{stiffness:180,damping:12},stiff:{stiffness:260,damping:26}},l=function(t){var e=void 0===t?{}:t,i=e.flipperSpring,n=e.flippedSpring,r=function(t){return e=t,"[object Object]"===Object.prototype.toString.call(e)?t:s[t]?s[t]:{};var e};return a({},s.noWobble,r(i),r(n))},p=function(t,e,i){var n=t(e).map(function(t){return t.dataset.flipId});return i.filter(function(t){return n.indexOf(t)>-1})},u="[data-flip-id]:not([data-is-appearing])";function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,i){return e&&d(t.prototype,e),i&&d(t,i),t}"undefined"!=typeof window&&(o=window.requestAnimationFrame);var g=o=o||function(t){window.setTimeout(t,1e3/60)};var m=Date.now(),v="object"===("undefined"==typeof performance?"undefined":c(performance))&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()-m};function y(t,e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}var S=function(){function t(){f(this,t)}return h(t,[{key:"run",value:function(){var t=this;g(function(){t.springSystem.loop(v())})}}]),t}(),E=function t(){f(this,t),this.position=0,this.velocity=0},_=function(){function t(e){f(this,t),this._id="s"+t._ID++,this._springSystem=e,this.listeners=[],this._startValue=0,this._currentState=new E,this._displacementFromRestThreshold=.001,this._endValue=0,this._overshootClampingEnabled=!1,this._previousState=new E,this._restSpeedThreshold=.001,this._tempState=new E,this._timeAccumulator=0,this._wasAtRest=!0}return h(t,[{key:"getId",value:function(){return this._id}},{key:"destroy",value:function(){this.listeners=[],this._springSystem.deregisterSpring(this)}},{key:"setSpringConfig",value:function(t){return this._springConfig=t,this}},{key:"getCurrentValue",value:function(){return this._currentState.position}},{key:"getDisplacementDistanceForState",value:function(t){return Math.abs(this._endValue-t.position)}},{key:"setEndValue",value:function(t){if(this._endValue===t&&this.isAtRest())return this;this._startValue=this.getCurrentValue(),this._endValue=t,this._springSystem.activateSpring(this.getId());for(var e=0,i=this.listeners.length;e<i;e++){var n=this.listeners[e].onSpringEndStateChange;n&&n(this)}return this}},{key:"setVelocity",value:function(t){return t===this._currentState.velocity?this:(this._currentState.velocity=t,this._springSystem.activateSpring(this.getId()),this)}},{key:"setOvershootClampingEnabled",value:function(t){return this._overshootClampingEnabled=t,this}},{key:"isOvershooting",value:function(){var t=this._startValue,e=this._endValue;return this._springConfig.tension>0&&(t<e&&this.getCurrentValue()>e||t>e&&this.getCurrentValue()<e)}},{key:"advance",value:function(e,i){var n=this.isAtRest();if(!n||!this._wasAtRest){var r=i;i>t.MAX_DELTA_TIME_SEC&&(r=t.MAX_DELTA_TIME_SEC),this._timeAccumulator+=r;for(var a,o,s,l,p,u,c,f,d=this._springConfig.tension,h=this._springConfig.friction,g=this._currentState.position,m=this._currentState.velocity,v=this._tempState.position,y=this._tempState.velocity;this._timeAccumulator>=t.SOLVER_TIMESTEP_SEC;)this._timeAccumulator-=t.SOLVER_TIMESTEP_SEC,this._timeAccumulator<t.SOLVER_TIMESTEP_SEC&&(this._previousState.position=g,this._previousState.velocity=m),a=m,o=d*(this._endValue-v)-h*m,v=g+a*t.SOLVER_TIMESTEP_SEC*.5,s=y=m+o*t.SOLVER_TIMESTEP_SEC*.5,l=d*(this._endValue-v)-h*y,v=g+s*t.SOLVER_TIMESTEP_SEC*.5,p=y=m+l*t.SOLVER_TIMESTEP_SEC*.5,u=d*(this._endValue-v)-h*y,v=g+p*t.SOLVER_TIMESTEP_SEC,c=y=m+u*t.SOLVER_TIMESTEP_SEC,f=1/6*(o+2*(l+u)+(d*(this._endValue-v)-h*y)),g+=1/6*(a+2*(s+p)+c)*t.SOLVER_TIMESTEP_SEC,m+=f*t.SOLVER_TIMESTEP_SEC;this._tempState.position=v,this._tempState.velocity=y,this._currentState.position=g,this._currentState.velocity=m,this._timeAccumulator>0&&this._interpolate(this._timeAccumulator/t.SOLVER_TIMESTEP_SEC),(this.isAtRest()||this._overshootClampingEnabled&&this.isOvershooting())&&(this._springConfig.tension>0?(this._startValue=this._endValue,this._currentState.position=this._endValue):(this._endValue=this._currentState.position,this._startValue=this._endValue),this.setVelocity(0),n=!0);var S=!1;this._wasAtRest&&(this._wasAtRest=!1,S=!0);var E=!1;n&&(this._wasAtRest=!0,E=!0),this.notifyPositionUpdated(S,E)}}},{key:"notifyPositionUpdated",value:function(t,e){for(var i=0,n=this.listeners.length;i<n;i++){var r=this.listeners[i];t&&r.onSpringActivate&&r.onSpringActivate(this),r.onSpringUpdate&&r.onSpringUpdate(this),e&&r.onSpringAtRest&&r.onSpringAtRest(this)}}},{key:"systemShouldAdvance",value:function(){return!this.isAtRest()||!this.wasAtRest()}},{key:"wasAtRest",value:function(){return this._wasAtRest}},{key:"isAtRest",value:function(){return Math.abs(this._currentState.velocity)<this._restSpeedThreshold&&(this.getDisplacementDistanceForState(this._currentState)<=this._displacementFromRestThreshold||0===this._springConfig.tension)}},{key:"_interpolate",value:function(t){this._currentState.position=this._currentState.position*t+this._previousState.position*(1-t),this._currentState.velocity=this._currentState.velocity*t+this._previousState.velocity*(1-t)}},{key:"addListener",value:function(t){return this.listeners.push(t),this}},{key:"removeListener",value:function(t){return y(this.listeners,t),this}}]),t}();_._ID=0,_.MAX_DELTA_TIME_SEC=.064,_.SOLVER_TIMESTEP_SEC=.001;var C=new(function(){function t(e){f(this,t),this.looper=e||new S,this.looper.springSystem=this,this.listeners=[],this._activeSprings=[],this._idleSpringIndices=[],this._isIdle=!0,this._lastTimeMillis=-1,this._springRegistry={}}return h(t,[{key:"createSpring",value:function(t,e){return this.createSpringWithConfig({tension:t,friction:e})}},{key:"createSpringWithConfig",value:function(t){var e=new _(this);return this.registerSpring(e),e.setSpringConfig(t),e}},{key:"getIsIdle",value:function(){return this._isIdle}},{key:"registerSpring",value:function(t){this._springRegistry[t.getId()]=t}},{key:"deregisterSpring",value:function(t){y(this._activeSprings,t),delete this._springRegistry[t.getId()]}},{key:"advance",value:function(t,e){for(var i=this;this._idleSpringIndices.length>0;)this._idleSpringIndices.pop();for(this._activeSprings.filter(Boolean).forEach(function(n){n.systemShouldAdvance()?n.advance(t/1e3,e/1e3):i._idleSpringIndices.push(i._activeSprings.indexOf(n))});this._idleSpringIndices.length>0;){var n=this._idleSpringIndices.pop();n>=0&&this._activeSprings.splice(n,1)}}},{key:"loop",value:function(t){var e;-1===this._lastTimeMillis&&(this._lastTimeMillis=t-1);var i=t-this._lastTimeMillis;this._lastTimeMillis=t;var n=0,r=this.listeners.length;for(n=0;n<r;n++)(e=this.listeners[n]).onBeforeIntegrate&&e.onBeforeIntegrate(this);for(this.advance(t,i),0===this._activeSprings.length&&(this._isIdle=!0,this._lastTimeMillis=-1),n=0;n<r;n++)(e=this.listeners[n]).onAfterIntegrate&&e.onAfterIntegrate(this);this._isIdle||this.looper.run()}},{key:"activateSpring",value:function(t){var e=this._springRegistry[t];-1===this._activeSprings.indexOf(e)&&this._activeSprings.push(e),this.getIsIdle()&&(this._isIdle=!1,this.looper.run())}}]),t}()),I=function(t){var e=t.springConfig,i=e.stiffness,n=e.damping,r=e.overshootClamping,a=t.noOp,o=t.onSpringActivate,s=t.getOnUpdateFunc,l=t.onAnimationEnd;if(a)return null;var p=C.createSpring(i,n);return p.setOvershootClampingEnabled(!!r),p.addListener({onSpringActivate:o,onSpringUpdate:s(p.destroy.bind(p)),onSpringAtRest:function(){p.destroy(),l()}}),p},b=function(t){t&&t.forEach(function(t){!function(t){var e=I(t);e?e.setEndValue(1):t.onSpringActivate()}(t),b(t.immediateChildren)})},A=function(t){var e=t.staggerConfig,i=function(t){t&&Object.keys(t).length&&Object.keys(t).forEach(function(i){return function(t,e){if(void 0===e&&(e={}),t&&t.length){e.reverse&&t.reverse();var i=e.speed?1+Math.max(Math.min(e.speed,0),1):1.1,n=1/Math.max(Math.min(t.length,100),10),r=t.filter(function(t){return!t.noOp}).map(function(t,e){var a=t.getOnUpdateFunc;return t.getOnUpdateFunc=function(t){var o=a(t);return function(t){var a=t.getCurrentValue();a>n&&r[e+1]&&r[e+1].setEndValue(Math.min(a*i,1)),o(t)}},t}).map(function(t){return I(t)});r[0]&&r[0].setEndValue(1)}}(t[i],e[i])})},n=function(t){var e=t.flipDataDict,i=t.topLevelChildren,n=t.initiateStaggeredAnimations,r={root:{staggeredChildren:{},immediateChildren:[]}},a=function(t,i){var r=e[i];r&&(r.stagger?t.staggeredChildren[r.stagger]?t.staggeredChildren[r.stagger].push(r):t.staggeredChildren[r.stagger]=[r]:t.immediateChildren.push(r),r.onSpringActivate=function(){b(r.immediateChildren),n(r.staggeredChildren)},r.staggeredChildren={},r.immediateChildren=[],r.childIds.forEach(function(t){return a(r,t)}))};return i.forEach(function(t){a(r.root,t)}),r}({flipDataDict:t.flipDataDict,topLevelChildren:t.topLevelChildren,initiateStaggeredAnimations:i});b(n.root.immediateChildren),i(n.root.staggeredChildren)},w=function(t){return[0,1,4,5,12,13].map(function(e){return t[e]})},O=function(t){var e=t.top,i=t.bottom,n=t.left,r=t.right;return e<window.innerHeight&&i>0&&n<window.innerWidth&&r>0},T=function(t,e,i){return t+(e-t)*i},x=function(o){var s,c,f=o.flippedIds,d=o.flipCallbacks,h=o.inProgressAnimations,g=o.flippedElementPositionsBeforeUpdate,m=o.flippedElementPositionsAfterUpdate,v=o.applyTransformOrigin,y=o.spring,S=o.getElement,E=o.debug,_=o.staggerConfig,C=o.decisionData,I=void 0===C?{}:C,b=o.scopedSelector,x=o.retainTransform,k=o.onComplete,V=new Promise(function(t){s=t});if(k&&V.then(k),!f.length)return function(){return s([]),V};var M=[],P=S(f[0]),R=P?P.ownerDocument.querySelector("body"):document.querySelector("body");E&&console.error('[react-flip-toolkit]\nThe "debug" prop is set to true. All FLIP animations will return at the beginning of the transition.');var D,F=(D=f.reduce(function(t,e){return t[e]=(t[e]||0)+1,t},{}),Object.keys(D).filter(function(t){return D[t]>1}));F.length&&console.error("[react-flip-toolkit]\nThere are currently multiple elements with the same flipId on the page.\nThe animation will only work if each Flipped component has a unique flipId.\nDuplicate flipId"+(F.length>1?"s":"")+": "+F.join("\n"));var U=f.map(function(o){var p=g[o].rect,u=m[o].rect,f=g[o].opacity,E=m[o].opacity,_=u.width<1||u.height<1;if(!O(p)&&!O(u))return!1;if(0===p.width&&0===u.width||0===p.height&&0===u.height)return!1;var C=S(o);if(!C)return!1;var b=JSON.parse(C.dataset.flipConfig),A=l({flipperSpring:y,flippedSpring:b.spring}),k=!0===b.stagger?"default":b.stagger,V={element:C,id:o,stagger:k,springConfig:A,noOp:!0};if(d[o]&&d[o].shouldFlip&&!d[o].shouldFlip(I.prev,I.current))return V;var P=Math.abs(p.left-u.left)+Math.abs(p.top-u.top),D=Math.abs(p.width-u.width)+Math.abs(p.height-u.height),F=Math.abs(E-f);if(P<.5&&D<.5&&F<.01)return V;V.noOp=!1;var U,L,j=function(i){if("string"==typeof i){var n=i.match(/matrix(3d)?\(([^)]+)\)/);if(n)return t(n[2].split(", ").map(parseFloat))}return e()}(m[o].transform),B={matrix:j},q={matrix:[]},X=[j];b.translate&&(X.push((U=p.left-u.left,(L=e())[12]=U,L)),X.push(function(t){var i=e();return i[13]=t,i}(p.top-u.top))),b.scale&&(X.push(function(t){var i=e();return i[0]=t,i}(Math.max(p.width,1)/Math.max(u.width,1))),X.push(function(t){var i=e();return i[5]=t,i}(Math.max(p.height,1)/Math.max(u.height,1)))),b.opacity&&(q.opacity=f,B.opacity=E);var W=[];if(!d[o]||!d[o].shouldInvert||d[o].shouldInvert(I.prev,I.current)){var N=function(t,e){return r(t.querySelectorAll('[data-inverse-flip-id="'+e+'"]'))}(C,o);W=N.map(function(t){return[t,JSON.parse(t.dataset.flipConfig)]})}q.matrix=w(X.reduce(i)),B.matrix=w(B.matrix);var Y,K=function(t){var e=t.element,i=t.invertedChildren,r=t.body,a=t.retainTransform;return function(t){var o=t.matrix,s=t.opacity,l=t.forceMinVals;if(n(s)&&(e.style.opacity=s+""),l&&(e.style.minHeight="1px",e.style.minWidth="1px"),o){var p=function(t){return"matrix("+t.join(", ")+")"}(o);a&&"matrix(1, 0, 0, 1, 0, 0)"===p&&(p="matrix(1, 0.00001, -0.00001, 1, 0, 0)"),e.style.transform=p,i&&function(t){var e=t.invertedChildren,i=t.matrix,n=t.body;e.forEach(function(t){var e=t[0],r=t[1];if(n.contains(e)){var a=i[0],o=i[3],s=i[4],l=i[5],p={translateX:0,translateY:0,scaleX:1,scaleY:1},u="";r.translate&&(p.translateX=-s/a,p.translateY=-l/o,u+="translate("+p.translateX+"px, "+p.translateY+"px)"),r.scale&&(p.scaleX=1/a,p.scaleY=1/o,u+=" scale("+p.scaleX+", "+p.scaleY+")"),e.style.transform=u}})}({invertedChildren:i,matrix:o,body:r})}}}({element:C,invertedChildren:W,body:R,retainTransform:x});if(d[o]&&d[o].onComplete){var J=d[o].onComplete;Y=function(){return J(C,I.prev,I.current)}}var z=n(q.opacity)&&n(B.opacity)&&q.opacity!==B.opacity,H=!1;return a({},V,{stagger:k,springConfig:A,getOnUpdateFunc:function(t){h[o]={stop:t,onComplete:Y};return function(e){d[o]&&d[o].onSpringUpdate&&d[o].onSpringUpdate(e.getCurrentValue()),H||(H=!0,d[o]&&d[o].onStart&&d[o].onStart(C,I.prev,I.current));var i=e.getCurrentValue();if(R.contains(C)){var n={matrix:[]};n.matrix=q.matrix.map(function(t,e){return T(t,B.matrix[e],i)}),z&&(n.opacity=T(q.opacity,B.opacity,i)),K(n)}else t()}},initializeFlip:function(){K({matrix:q.matrix,opacity:z?q.opacity:void 0,forceMinVals:_}),d[o]&&d[o].onStartImmediate&&d[o].onStartImmediate(C,I.prev,I.current),b.transformOrigin?C.style.transformOrigin=b.transformOrigin:v&&(C.style.transformOrigin="0 0"),W.forEach(function(t){var e=t[0],i=t[1];i.transformOrigin?e.style.transformOrigin=i.transformOrigin:v&&(e.style.transformOrigin="0 0")})},onAnimationEnd:function(){delete h[o],"function"==typeof Y&&Y(),C.style.transform="",_&&C&&(C.style.minHeight="",C.style.minWidth=""),M.push(o),M.length>=c.length&&s(M)}})}).filter(function(t){return t});if((c=U.filter(function(t){var e=t.initializeFlip;return Boolean(e)})).forEach(function(t){return(0,t.initializeFlip)()}),E)return function(){};var L=U.reduce(function(t,e){return t[e.id]=e,t},{}),j=function(t){var e=t.flipDataDict,i=t.flippedIds,n=t.scopedSelector,a={},o=function(t,r,s){var l=t+" "+u,c=p(n,l,i),f=s.filter(function(t){return-1===c.indexOf(t)});a[r]=f,f.forEach(function(t){e[t]&&(e[t].level=r)}),0!==c.length&&o(l,r+1,c)};return o(u,0,p(n,u,i)),Object.keys(e).forEach(function(t){var n=e[t];n.childIds=p(function(t){return r(n.element.querySelectorAll(t))},u,i),n.childIds=n.childIds.filter(function(t){return a[n.level+1]&&a[n.level+1].indexOf(t)>-1})}),a[0]}({flipDataDict:L,flippedIds:f,scopedSelector:b});return function(){return c.length||s([]),A({topLevelChildren:j,flipDataDict:L,staggerConfig:_}),V}},k=function(t,e){var i;return a(t,((i={})[e[0]]=e[1],i))},V=function(t,e){return r(e?document.querySelectorAll('[data-portal-key="'+e+'"]'):t.querySelectorAll("[data-flip-id]"))},M=function(t,e){return e?function(t){return r(document.querySelectorAll("[data-portal-key="+e+"]"+t))}:t?function(e){return r(t.querySelectorAll(e))}:function(){return[]}},P=function(t){var e=t.cachedOrderedFlipIds,i=void 0===e?[]:e,n=t.inProgressAnimations,r=void 0===n?{}:n,o=t.flippedElementPositionsBeforeUpdate,s=void 0===o?{}:o,l=t.flipCallbacks,p=void 0===l?{}:l,u=t.containerEl,c=t.applyTransformOrigin,f=t.spring,d=t.debug,h=t.portalKey,g=t.staggerConfig,m=void 0===g?{}:g,v=t.decisionData,y=void 0===v?{}:v,S=t.handleEnterUpdateDelete,E=t.retainTransform,_=t.onComplete,C=function(t){var e=t.element,i=t.portalKey;return V(e,i).map(function(t){var e=window.getComputedStyle(t),i=t.getBoundingClientRect();return[t.dataset.flipId,{rect:i,opacity:parseFloat(e.opacity),transform:e.transform}]}).reduce(k,{})}({element:u,portalKey:h}),I=M(u,h),b=function(t,e){if(!t&&!e)throw new Error("either portalKey or element must be provided");return function(i){return M(t,e)('[data-flip-id="'+i+'"]')[0]}}(u,h),A=function(t){return s[t]&&C[t]},w=Object.keys(s).concat(Object.keys(C)).filter(function(t){return!A(t)}),O={flipCallbacks:p,getElement:b,flippedElementPositionsBeforeUpdate:s,flippedElementPositionsAfterUpdate:C,inProgressAnimations:r},T=function(t){var e=t.unflippedIds,i=t.flipCallbacks,n=t.getElement,r=t.flippedElementPositionsBeforeUpdate,a=t.flippedElementPositionsAfterUpdate,o=t.inProgressAnimations,s=e.filter(function(t){return a[t]}),l=s.filter(function(t){return i[t]&&i[t].onAppear}),p=e.filter(function(t){return r[t]&&i[t]&&i[t].onExit});s.forEach(function(t){var e=n(t);e&&(e.dataset.isAppearing="true")});var u,c=new Promise(function(t){u=t}),f=[],d=0,h=p.map(function(t,e){var n=r[t].domDataForExitAnimations,a=n.element,s=n.parent,l=n.childPosition,p=l.top,c=l.left,h=l.width,g=l.height;"static"===getComputedStyle(s).position&&(s.style.position="relative"),a.style.transform="matrix(1, 0, 0, 1, 0, 0)",a.style.position="absolute",a.style.top=p+"px",a.style.left=c+"px",a.style.height=g+"px",a.style.width=h+"px";var m=f.filter(function(t){return t[0]===s})[0];m||(m=[s,document.createDocumentFragment()],f.push(m)),m[1].appendChild(a),d+=1;var v=function(){try{s.removeChild(a)}catch(t){}finally{0==(d-=1)&&u()}};return o[t]={stop:v},function(){return i[t].onExit(a,e,v)}});f.forEach(function(t){var e=t[0],i=t[1];e.appendChild(i)}),h.length||u();return{hideEnteringElements:function(){l.forEach(function(t){var e=n(t);e&&(e.style.opacity="0")})},animateEnteringElements:function(){l.forEach(function(t,e){var r=n(t);r&&i[t].onAppear(r,e)})},animateExitingElements:function(){return h.forEach(function(t){return t()}),c}}}(a({},O,{unflippedIds:w})),P=T.hideEnteringElements,R=T.animateEnteringElements,D=T.animateExitingElements,F=a({},O,{flippedIds:i.filter(A),applyTransformOrigin:c,spring:f,debug:d,staggerConfig:m,decisionData:y,scopedSelector:I,retainTransform:E,onComplete:_}),U=x(F);w.filter(function(t){return C[t]}).forEach(function(t){var e=b(t);e&&e.removeAttribute("data-is-appearing")}),S?S({hideEnteringElements:P,animateEnteringElements:R,animateExitingElements:D,animateFlippedElements:U}):(P(),D().then(R),U())},R=function(t){var e=t.element,i=t.flipCallbacks,n=void 0===i?{}:i,o=t.inProgressAnimations,s=void 0===o?{}:o,l=t.portalKey,p=V(e,l),u=r(e.querySelectorAll("[data-inverse-flip-id]")),c={},f=[],d={};p.filter(function(t){return n&&n[t.dataset.flipId]&&n[t.dataset.flipId].onExit}).forEach(function(t){var e=t.parentNode;if(t.closest){var i=t.closest("[data-exit-container]");i&&(e=i)}var n=f.findIndex(function(t){return t[0]===e});-1===n&&(f.push([e,e.getBoundingClientRect()]),n=f.length-1),c[t.dataset.flipId]=f[n][1],d[t.dataset.flipId]=e});var h=p.map(function(t){var e={},i=t.getBoundingClientRect();if(n&&n[t.dataset.flipId]&&n[t.dataset.flipId].onExit){var r=c[t.dataset.flipId];a(e,{element:t,parent:d[t.dataset.flipId],childPosition:{top:i.top-r.top,left:i.left-r.left,width:i.width,height:i.height}})}return[t.dataset.flipId,{rect:i,opacity:parseFloat(window.getComputedStyle(t).opacity||"1"),domDataForExitAnimations:e}]}).reduce(k,{});return function(t){Object.keys(t).forEach(function(e){t[e].stop&&t[e].stop(),delete t[e]})}(s),p.concat(u).forEach(function(t){t.style.transform="",t.style.opacity=""}),{flippedElementPositions:h,cachedOrderedFlipIds:p.map(function(t){return t.dataset.flipId})}};return function(){function t(t){this.applyTransformOrigin=!0,this.retainTransform=!1,a(this,t),this.inProgressAnimations={},this.flipCallbacks={},this.recordBeforeUpdate=this.recordBeforeUpdate.bind(this),this.onUpdate=this.onUpdate.bind(this),this.addFlipped=this.addFlipped.bind(this),this.addInverted=this.addInverted.bind(this)}return t.prototype.recordBeforeUpdate=function(){this.snapshot=R({element:this.element,flipCallbacks:this.flipCallbacks,inProgressAnimations:this.inProgressAnimations})},t.prototype.onUpdate=function(t,e){this.snapshot&&(P({flippedElementPositionsBeforeUpdate:this.snapshot.flippedElementPositions,cachedOrderedFlipIds:this.snapshot.cachedOrderedFlipIds,containerEl:this.element,inProgressAnimations:this.inProgressAnimations,flipCallbacks:this.flipCallbacks,applyTransformOrigin:this.applyTransformOrigin,spring:this.spring,debug:this.debug,staggerConfig:this.staggerConfig,handleEnterUpdateDelete:this.handleEnterUpdateDelete,retainTransform:this.retainTransform,decisionData:{prev:t,current:e},onComplete:this.onComplete}),delete this.snapshot)},t.prototype.addFlipped=function(t){var e=t.element,i=t.flipId,n=t.opacity,r=t.translate,o=t.scale,s=t.transformOrigin,l=t.spring,p=t.stagger,u=t.onAppear,c=t.onStart,f=t.onSpringUpdate,d=t.onComplete,h=t.onExit,g=t.shouldFlip,m=t.shouldInvert;if(!e)throw new Error("no element provided");if(!i)throw new Error("No flipId provided");var v={scale:o,translate:r,opacity:n,transformOrigin:s,spring:l,stagger:p};v.scale||v.translate||v.opacity||a(v,{translate:!0,scale:!0,opacity:!0}),i&&(e.dataset.flipId=i),e.dataset.flipConfig=JSON.stringify(v),this.flipCallbacks[i]={shouldFlip:g,shouldInvert:m,onAppear:u,onStart:c,onSpringUpdate:f,onComplete:d,onExit:h}},t.prototype.addInverted=function(t){var e=t.element,i=t.parent,n=t.opacity,r=t.translate,o=t.scale,s=t.transformOrigin;if(!e)throw new Error("no element provided");if(!i)throw new Error("parent must be provided");var l=i.dataset.flipId,p={scale:o,translate:r,opacity:n,transformOrigin:s};p.scale||p.translate||p.opacity||a(p,{translate:!0,scale:!0,opacity:!0}),e.dataset.inverseFlipId=l,e.dataset.flipConfig=JSON.stringify(p)},t}()});
//# sourceMappingURL=core.min.js.map
